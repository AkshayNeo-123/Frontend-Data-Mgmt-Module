<h2 mat-dialog-title>New User</h2>
<mat-dialog-content>
  <form #userForm="ngForm" (ngSubmit)="onSubmit(userForm)" novalidate>
    <mat-hint class="global-hint">All fields marked with an asterisk (*) are required.</mat-hint><br>
    <mat-form-field appearance="outline" class="w-100 mb-3">
      <mat-label>User Id</mat-label>
      <input matInput name="userId" [value]="'PRO'+(newUser.userId.toString().padStart(3, '0'))" disabled />
    </mat-form-field>

    <div class="row">
      <mat-form-field appearance="outline" class="w-50 half-width">
        <mat-label>First Name</mat-label>
        <input matInput name="firstName" [(ngModel)]="newUser.firstName" required />
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-50 half-width">
        <mat-label>Last Name</mat-label>
        <input matInput name="lastName" [(ngModel)]="newUser.lastName" required />
      </mat-form-field>
    </div>

    <mat-form-field appearance="outline" class="w-100 mb-3">
      <mat-label>Email</mat-label>
      <input matInput type="email" name="email" [(ngModel)]="newUser.email" #email="ngModel" required email />
      <mat-error *ngIf="email.invalid && email.touched">
        Please enter a valid email address.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-100 mb-3">
      <mat-label>Role</mat-label>
      <mat-select [(ngModel)]="newUser.roleId" name="roleId" #role="ngModel" required>
        <mat-option value="">---Select---</mat-option>
        @for (item of roles; track item.roleId) {
        <mat-option [value]="item.roleId">{{ item.roleName }}</mat-option>
        }
      </mat-select>
      <mat-error *ngIf="role.invalid && role.touched">Role is required</mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-100 mb-3">
      <mat-label>Password</mat-label>
      <input matInput [type]="showPassword ? 'text' : 'password'" name="password" [(ngModel)]="newUser.passwordHash"
        #password="ngModel" required pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*[^A-Za-z0-9]).{6,}$" />
   
      <mat-error *ngIf="password.invalid && password.touched">
        Password must have at least 1 uppercase, 1 lowercase, 1 special character, and be minimum 6 characters long.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-100 mb-3">
      <mat-label>Confirm Password</mat-label>
      <input matInput [type]="showConfirmPassword ? 'text' : 'password'" name="confirmPassword"
        [(ngModel)]="newUser.confirmPasswordHash" #confirmPassword="ngModel" required />
      <button mat-icon-button matSuffix type="button" (click)="toggleConfirmPasswordVisibility()" tabindex="-1">
        <mat-icon>{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
    </mat-form-field>
    <div
      *ngIf="(confirmPassword.value !== password.value && confirmPassword.dirty) ||(confirmPassword.invalid && confirmPassword.touched)"
      class="text-danger" style="margin-top: -32px;
    margin-left: 21px; margin-bottom: 16px;">
      <small>Passwords do not match.</small>
    </div>

    <mat-form-field appearance="outline" class="w-100 mb-3">
      <mat-label>Phone Number</mat-label>
      <input matInput type="tel" (keypress)="allowOnlyNumbers($event)" pattern="^[0-9]{10}$" maxlength="10"
        [(ngModel)]="newUser.phone" name="phone" required #phoneInput="ngModel">
      <mat-error *ngIf="phoneInput.invalid && phoneInput.touched">
        Phone number must be 10 digits
      </mat-error>
    </mat-form-field>

    <label class="mb-2">Account Status *</label>
    <mat-radio-group [(ngModel)]="newUser.status" name="status" required>
      <mat-radio-button value="Active">Active</mat-radio-button>
      <mat-radio-button value="InActive">InActive</mat-radio-button>
    </mat-radio-group>
    <div class="text-danger" *ngIf="!newUser.status && userForm.submitted">
      Account Status is required
    </div>

    <mat-dialog-actions align="end" class="btnFix">
      <button mat-raised-button color="primary" type="submit">Save</button>
      <button mat-raised-button type="button" (click)="onCancel()">Cancel</button>
    </mat-dialog-actions>
  </form>
</mat-dialog-content>