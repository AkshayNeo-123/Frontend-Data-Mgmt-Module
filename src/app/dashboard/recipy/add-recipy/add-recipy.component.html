<div class="p-4" style="max-height: 80vh; overflow-y: auto">
<h2 mat-dialog-title class="mb-4">{{ isEdit ? 'Update Recipe' : 'New Recipe' }}</h2>
  <mat-hint class="global-hint mb-3 text-muted"
    >All fields marked with an asterisk (*) are required.</mat-hint
  >
 
  <form [formGroup]="recipeForm" (ngSubmit)="onSubmit()">
    <div mat-dialog-content>
      <div class="row">
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Recipe Name</mat-label>
            <input matInput formControlName="productName" required />
            <mat-error
              *ngIf="recipeForm.get('productName')?.hasError('required')"
              >Product Name is required</mat-error
            >
          </mat-form-field>
        </div>
 
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Project Number</mat-label>
            <mat-select formControlName="projectId" required>
              <mat-option
                *ngFor="let project of projects"
                [value]="project.projectId"
              >
                {{ project.projectNumber }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="recipeForm.get('projectId')?.hasError('required')"
              >Project Number is required</mat-error
            >
          </mat-form-field>
        </div>
 
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Additive</mat-label>
            <mat-select formControlName="additiveId">
              <mat-option
                *ngFor="let additive of additives"
                [value]="additive.id"
              >
                {{ additive.additiveName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
 
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Main Polymer</mat-label>
            <mat-select formControlName="mainPolymerId">
              <mat-option
                *ngFor="let polymer of mainPolymers"
                [value]="polymer.id"
              >
                {{ polymer.polymerName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
 
        <div class="col-md-12">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Comments</mat-label>
            <textarea matInput formControlName="comments" rows="3"></textarea>
          </mat-form-field>
        </div>
      </div>
    </div>
<div formArrayName="components" class="mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <label class="fw-bold fs-5">Components</label>
    <button
      type="button"
      class="btn btn-outline-primary btn-sm"
      (click)="addComponent()"
    >
      Add Component
    </button>
  </div>
  <div class="table-responsive"  *ngIf="components.controls.length > 0">
    <table class="table table-bordered align-middle text-center">
      <thead class="table-light">
        <tr >
          <th>Component*</th>
          <th>WT%</th>
          <th>VOL%</th>
          <th>Density</th>
          <th>Type*</th>
          <th>MP / MF</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let comp of components.controls; let i = index"
          [formGroupName]="i"
        >
          <!-- Component dropdown -->
          <td>
            <select
              class="form-select"
              formControlName="componentId"
             
            >
            <option [ngValue]=null>--Select--</option>
              <option
                *ngFor="let c of availableComponents"
                [value]="c.id"
              >
                {{ c.componentName }}
              </option>
            </select>
          </td>
          <!-- WT% input -->
          <td>
            <input
              type="number"
              min="0"
              max="100"
              step="0.1"
              class="form-control"
              formControlName="wtPercent"
            />
          </td>
          <!-- VOL% input -->
          <td>
            <input
              type="number"
              min="0"
              max="100"
              step="0.1"
              class="form-control"
              formControlName="valPercent"
            />
          </td>
          <!-- Density input -->
          <td>
            <input
              type="number"
              min="0"
              max="25"
              step="0.01"
              class="form-control"
              formControlName="density"
            />
          </td>
          <!-- Type dropdown -->
          <td>
            <select
              class="form-select"
              formControlName="typeId"
              
            >
            <option [ngValue]=null>--Select--</option>
              <option
                *ngFor="let type of componentTypes"
                [value]="type.id"
              >
                {{ type.type }}
              </option>
            </select>
          </td>
          <!-- MP / MF checkboxes -->
          <td>
            <div class="form-check form-check-inline">
              <input
                class="form-check-input"
                type="checkbox"
                formControlName="mp"
                id="mp-{{ i }}"
              />
              <label class="form-check-label" for="mp-{{ i }}">MP</label>
            </div>
            <div class="form-check form-check-inline">
              <input
                class="form-check-input"
                type="checkbox"
                formControlName="mf"
                id="mf-{{ i }}"
              />
              <label class="form-check-label" for="mf-{{ i }}">MF</label>
            </div>
          </td>
          <!-- Delete button -->
          <td>
            <button
              type="button"
              class="btn btn-sm btn-danger"
              (click)="deleteComponent(i)"
            >
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
 
 
 
 
 
    <div class="mt-4 d-flex justify-content-end gap-2">
      <button mat-raised-button type="submit" color="primary">{{isEdit ? 'Update' :'Save'}}</button>
      <button
        mat-stroked-button
        type="button"
        color="warn"
        (click)="onCancel()"
      >
        Cancel
      </button>
    </div>
  </form>
</div>
 
 
